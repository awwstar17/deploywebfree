<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Deployer Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body style="min-height: 100vh; padding: 1rem; background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%); background-attachment: fixed; font-family: system-ui, -apple-system, sans-serif;">
    
    <div style="max-width: 64rem; margin: 0 auto; padding: 2rem 0;">
        
        <!-- Header -->
        <div style="text-align: center; margin-bottom: 2.5rem;">
            <h1 style="font-size: 3rem; font-weight: 800; color: white; margin-bottom: 0.5rem;">âš¡ HTML Deployer Pro</h1>
            <p style="color: #94a3b8; font-size: 1.125rem;">Deploy HTML ke Vercel dengan fitur lengkap</p>
        </div>

        <!-- Setup Section -->
        <div id="setupSection" style="background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem;">
            <h2 style="font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 1.5rem;">âš™ï¸ Setup Token</h2>
            
            <div style="margin-bottom: 1.5rem;">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; color: #d1d5db; margin-bottom: 0.5rem;">
                        GitHub Token <a href="#" onclick="showGitHubHelp()" style="color: #a78bfa; font-size: 0.75rem; margin-left: 0.25rem; text-decoration: none;">(Tutorial)</a>
                    </label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx" 
                        style="width: 100%; padding: 0.75rem 1rem; background: rgba(15, 23, 42, 0.5); border: 1px solid #475569; border-radius: 0.5rem; color: white; font-size: 0.875rem;">
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; color: #d1d5db; margin-bottom: 0.5rem;">GitHub Username</label>
                    <input type="text" id="githubUsername" placeholder="username" 
                        style="width: 100%; padding: 0.75rem 1rem; background: rgba(15, 23, 42, 0.5); border: 1px solid #475569; border-radius: 0.5rem; color: white; font-size: 0.875rem;">
                </div>

                <div style="margin-bottom: 1rem;">
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; color: #d1d5db; margin-bottom: 0.5rem;">
                        Vercel Token <a href="#" onclick="showVercelHelp()" style="color: #a78bfa; font-size: 0.75rem; margin-left: 0.25rem; text-decoration: none;">(Tutorial)</a>
                    </label>
                    <input type="password" id="vercelToken" placeholder="xxxxxxxxxx" 
                        style="width: 100%; padding: 0.75rem 1rem; background: rgba(15, 23, 42, 0.5); border: 1px solid #475569; border-radius: 0.5rem; color: white; font-size: 0.875rem;">
                </div>
            </div>

            <button onclick="saveTokens()" style="width: 100%; background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%); color: white; font-weight: 700; padding: 0.75rem 1.5rem; border-radius: 0.5rem; border: none; cursor: pointer; font-size: 1rem;">
                ğŸ’¾ Simpan Token
            </button>
            
            <div id="tokenStatus" style="margin-top: 1rem; text-align: center;"></div>
        </div>

        <!-- Tab Navigation -->
        <div id="tabNav" style="background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 1rem; padding: 0.5rem; margin-bottom: 1.5rem; display: none; display: flex; gap: 0.5rem;">
            <button onclick="switchTab('editor')" id="tabEditor" style="flex: 1; padding: 0.75rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%); color: white;">
                ğŸ“ Editor
            </button>
            <button onclick="switchTab('upload')" id="tabUpload" style="flex: 1; padding: 0.75rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; background: rgba(15, 23, 42, 0.5); color: #94a3b8;">
                ğŸ“¤ Upload
            </button>
            <button onclick="switchTab('history')" id="tabHistory" style="flex: 1; padding: 0.75rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; background: rgba(15, 23, 42, 0.5); color: #94a3b8;">
                ğŸ“œ History
            </button>
        </div>

        <!-- Editor Section -->
        <div id="editorSection" style="background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; display: none;">
            <h2 style="font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 1.5rem;">ğŸ“ HTML Editor</h2>
            
            <div style="margin-bottom: 1rem;">
                <label style="display: block; font-size: 0.875rem; font-weight: 600; color: #d1d5db; margin-bottom: 0.5rem;">Nama Project</label>
                <input type="text" id="editorProjectName" placeholder="my-website" 
                    style="width: 100%; padding: 0.75rem 1rem; background: rgba(15, 23, 42, 0.5); border: 1px solid #475569; border-radius: 0.5rem; color: white; font-size: 0.875rem;">
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; font-size: 0.875rem; font-weight: 600; color: #d1d5db; margin-bottom: 0.5rem;">HTML Code</label>
                <textarea id="htmlEditor" placeholder="<html>..." 
                    style="width: 100%; height: 20rem; padding: 1rem; background: rgba(15, 23, 42, 0.8); border: 1px solid #475569; border-radius: 0.5rem; color: white; font-size: 0.875rem; font-family: 'Courier New', monospace; resize: vertical;"><!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Website</title>
</head>
<body>
    <h1>Hello World!</h1>
    <p>Welcome to my website</p>
</body>
</html></textarea>
            </div>

            <div style="display: flex; gap: 0.75rem; margin-bottom: 1rem;">
                <button onclick="previewHTML()" style="flex: 1; background: rgba(59, 130, 246, 0.8); color: white; font-weight: 600; padding: 0.75rem; border-radius: 0.5rem; border: none; cursor: pointer;">
                    ğŸ‘ï¸ Preview
                </button>
                <button onclick="deployFromEditor()" style="flex: 1; background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; font-weight: 700; padding: 0.75rem; border-radius: 0.5rem; border: none; cursor: pointer;">
                    ğŸš€ Deploy
                </button>
            </div>

            <div id="previewFrame" style="display: none; border: 2px solid #475569; border-radius: 0.5rem; background: white; min-height: 20rem;"></div>
        </div>

        <!-- Upload Section -->
        <div id="uploadSection" style="background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; display: none;">
            <h2 style="font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 1.5rem;">ğŸ“¤ Upload File</h2>
            
            <div style="margin-bottom: 1rem;">
                <label style="display: block; font-size: 0.875rem; font-weight: 600; color: #d1d5db; margin-bottom: 0.5rem;">Nama Project</label>
                <input type="text" id="uploadProjectName" placeholder="my-website" 
                    style="width: 100%; padding: 0.75rem 1rem; background: rgba(15, 23, 42, 0.5); border: 1px solid #475569; border-radius: 0.5rem; color: white; font-size: 0.875rem;">
            </div>

            <div id="dropZone" style="border: 3px dashed #475569; border-radius: 0.5rem; padding: 2rem; text-align: center; cursor: pointer; background: rgba(15, 23, 42, 0.3); margin-bottom: 1rem;">
                <input type="file" id="fileInput" accept=".html" style="display: none;">
                <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">ğŸ“</div>
                <p style="color: white; font-weight: 600; margin-bottom: 0.25rem;">Drop file HTML disini</p>
                <p style="color: #94a3b8; font-size: 0.875rem;">atau klik untuk pilih file</p>
            </div>

            <div id="filePreview" style="display: none; padding: 1rem; background: rgba(15, 23, 42, 0.5); border: 1px solid #475569; border-radius: 0.5rem; margin-bottom: 1rem;">
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                    <div style="font-size: 1.5rem;">âœ“</div>
                    <div>
                        <p style="font-size: 0.75rem; color: #94a3b8;">File:</p>
                        <p id="fileName" style="color: white; font-weight: 600; font-size: 0.875rem;"></p>
                    </div>
                </div>
                <button onclick="previewFile()" style="width: 100%; background: rgba(59, 130, 246, 0.8); color: white; font-weight: 600; padding: 0.5rem; border-radius: 0.5rem; border: none; cursor: pointer; font-size: 0.875rem;">
                    ğŸ‘ï¸ Preview File
                </button>
            </div>

            <button onclick="deployFromUpload()" id="uploadDeployBtn" style="width: 100%; background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; font-weight: 700; padding: 0.75rem; border-radius: 0.5rem; border: none; cursor: pointer; font-size: 1rem;">
                ğŸš€ Deploy Sekarang
            </button>
        </div>

        <!-- History Section -->
        <div id="historySection" style="background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="font-size: 1.5rem; font-weight: 700; color: white;">ğŸ“œ Deploy History</h2>
                <button onclick="clearHistory()" style="background: rgba(239, 68, 68, 0.8); color: white; font-weight: 600; padding: 0.5rem 1rem; border-radius: 0.5rem; border: none; cursor: pointer; font-size: 0.875rem;">
                    ğŸ—‘ï¸ Clear All
                </button>
            </div>
            <div id="historyList" style="color: #94a3b8;"></div>
        </div>

        <!-- Progress Section -->
        <div id="progressSection" style="background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; display: none;">
            <h2 style="font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 1rem;">â³ Deploying...</h2>
            <div id="progressLog" style="font-family: 'Courier New', monospace; font-size: 0.875rem; background: rgba(15, 23, 42, 0.5); border-radius: 0.5rem; padding: 1rem; max-height: 15rem; overflow-y: auto;"></div>
        </div>

        <!-- Result Section -->
        <div id="resultSection" style="background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 1rem; padding: 1.5rem; display: none;">
            <div style="text-align: center; margin-bottom: 1.5rem;">
                <div style="font-size: 3.75rem; margin-bottom: 0.75rem;">âœ…</div>
                <h2 style="font-size: 1.875rem; font-weight: 700; color: white; margin-bottom: 0.5rem;">Berhasil!</h2>
                <p style="color: #d1d5db;">Website sudah live</p>
            </div>
            
            <div style="background: rgba(6, 78, 59, 0.3); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem;">
                <p style="font-size: 0.75rem; color: #d1d5db; margin-bottom: 0.5rem;">URL Website:</p>
                <a id="liveUrl" href="#" target="_blank" style="color: #4ade80; font-weight: 700; font-size: 1.125rem; word-break: break-all; display: block; margin-bottom: 0.75rem; text-decoration: none;"></a>
                <div style="display: flex; gap: 0.5rem;">
                    <button onclick="copyUrl()" style="flex: 1; background: rgba(15, 23, 42, 0.5); color: white; font-weight: 600; padding: 0.5rem; border-radius: 0.5rem; border: none; cursor: pointer; font-size: 0.875rem;">
                        ğŸ“‹ Copy
                    </button>
                    <button onclick="openUrl()" style="flex: 1; background: rgba(59, 130, 246, 0.8); color: white; font-weight: 600; padding: 0.5rem; border-radius: 0.5rem; border: none; cursor: pointer; font-size: 0.875rem;">
                        ğŸŒ Buka
                    </button>
                </div>
            </div>
            
            <button onclick="resetForm()" style="width: 100%; background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%); color: white; font-weight: 700; padding: 0.75rem; border-radius: 0.5rem; border: none; cursor: pointer; font-size: 1rem;">
                ğŸ”„ Deploy Lagi
            </button>
        </div>

        <!-- Preview Modal -->
        <div id="previewModal" style="position: fixed; inset: 0; background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(4px); display: none; align-items: center; justify-content: center; z-index: 50; padding: 1rem;">
            <div style="background: white; border-radius: 1rem; width: 100%; max-width: 60rem; height: 90vh; display: flex; flex-direction: column;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                    <h3 style="font-size: 1.25rem; font-weight: 700;">ğŸ‘ï¸ Preview</h3>
                    <button onclick="closePreview()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 0; width: 2rem; height: 2rem;">Ã—</button>
                </div>
                <iframe id="previewIframe" style="flex: 1; border: none; width: 100%;"></iframe>
            </div>
        </div>

        <!-- Help Modal -->
        <div id="helpModal" style="position: fixed; inset: 0; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(4px); display: none; align-items: center; justify-content: center; z-index: 50; padding: 1rem;">
            <div style="background: rgba(30, 41, 59, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 1rem; padding: 1.5rem; max-width: 42rem; max-height: 80vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="font-size: 1.25rem; font-weight: 700; color: white;">ğŸ“š Tutorial</h3>
                    <button onclick="closeHelp()" style="color: #94a3b8; background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 0; width: 2rem; height: 2rem;">Ã—</button>
                </div>
                <div id="helpContent" style="color: #d1d5db; font-size: 0.875rem;"></div>
            </div>
        </div>

    </div>

    <script>
        let htmlFile = null;
        let tokens = { github: null, githubUsername: null, vercel: null };
        let deployHistory = [];
        let currentTab = 'editor';

        window.onload = function() {
            const saved = localStorage.getItem('deployerTokens');
            if (saved) {
                tokens = JSON.parse(saved);
                document.getElementById('githubToken').value = tokens.github || '';
                document.getElementById('githubUsername').value = tokens.githubUsername || '';
                document.getElementById('vercelToken').value = tokens.vercel || '';
                if (tokens.github && tokens.vercel && tokens.githubUsername) {
                    document.getElementById('tokenStatus').innerHTML = '<div style="color: #4ade80; font-size: 0.875rem;">âœ… Token tersimpan</div>';
                    showMainUI();
                }
            }

            const savedHistory = localStorage.getItem('deployHistory');
            if (savedHistory) {
                deployHistory = JSON.parse(savedHistory);
            }
        };

        function showMainUI() {
            document.getElementById('tabNav').style.display = 'flex';
            switchTab('editor');
        }

        function switchTab(tab) {
            currentTab = tab;
            document.getElementById('editorSection').style.display = tab === 'editor' ? 'block' : 'none';
            document.getElementById('uploadSection').style.display = tab === 'upload' ? 'block' : 'none';
            document.getElementById('historySection').style.display = tab === 'history' ? 'block' : 'none';

            const tabs = ['tabEditor', 'tabUpload', 'tabHistory'];
            tabs.forEach(t => {
                const btn = document.getElementById(t);
                if (t === 'tab' + tab.charAt(0).toUpperCase() + tab.slice(1)) {
                    btn.style.background = 'linear-gradient(135deg, #9333ea 0%, #ec4899 100%)';
                    btn.style.color = 'white';
                } else {
                    btn.style.background = 'rgba(15, 23, 42, 0.5)';
                    btn.style.color = '#94a3b8';
                }
            });

            if (tab === 'history') {
                loadHistory();
            }
        }

        function saveTokens() {
            const github = document.getElementById('githubToken').value.trim();
            const githubUsername = document.getElementById('githubUsername').value.trim();
            const vercel = document.getElementById('vercelToken').value.trim();

            if (!github || !vercel || !githubUsername) {
                alert('Semua field harus diisi!');
                return;
            }

            tokens = { github, githubUsername, vercel };
            localStorage.setItem('deployerTokens', JSON.stringify(tokens));
            document.getElementById('tokenStatus').innerHTML = '<div style="color: #4ade80; font-size: 0.875rem;">âœ… Token tersimpan</div>';
            
            setTimeout(() => showMainUI(), 300);
        }

        function previewHTML() {
            const html = document.getElementById('htmlEditor').value;
            const iframe = document.getElementById('previewIframe');
            iframe.srcdoc = html;
            document.getElementById('previewModal').style.display = 'flex';
        }

        function previewFile() {
            if (!htmlFile) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const iframe = document.getElementById('previewIframe');
                iframe.srcdoc = e.target.result;
                document.getElementById('previewModal').style.display = 'flex';
            };
            reader.readAsText(htmlFile);
        }

        function closePreview() {
            document.getElementById('previewModal').style.display = 'none';
        }

        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.onclick = () => fileInput.click();
        dropZone.ondragover = (e) => { 
            e.preventDefault(); 
            dropZone.style.borderColor = '#8b5cf6';
            dropZone.style.background = 'rgba(139, 92, 246, 0.1)';
        };
        dropZone.ondragleave = () => {
            dropZone.style.borderColor = '#475569';
            dropZone.style.background = 'rgba(15, 23, 42, 0.3)';
        };
        dropZone.ondrop = (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#475569';
            dropZone.style.background = 'rgba(15, 23, 42, 0.3)';
            if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
        };
        fileInput.onchange = (e) => { if (e.target.files.length > 0) handleFile(e.target.files[0]); };

        function handleFile(file) {
            if (!file.name.endsWith('.html')) {
                alert('File harus .html!');
                return;
            }
            htmlFile = file;
            document.getElementById('filePreview').style.display = 'block';
            document.getElementById('fileName').textContent = file.name;
        }

        async function deployFromEditor() {
            const projectName = document.getElementById('editorProjectName').value.trim().toLowerCase();
            const htmlContent = document.getElementById('htmlEditor').value;
            
            if (!projectName || !/^[a-z0-9-]+$/.test(projectName)) {
                alert('Nama project harus huruf kecil, angka, atau dash');
                return;
            }

            if (!htmlContent.trim()) {
                alert('HTML code tidak boleh kosong!');
                return;
            }

            await deployHTML(projectName, htmlContent);
        }

        async function deployFromUpload() {
            if (!htmlFile) {
                alert('Upload file HTML dulu!');
                return;
            }

            const projectName = document.getElementById('uploadProjectName').value.trim().toLowerCase();
            if (!projectName || !/^[a-z0-9-]+$/.test(projectName)) {
                alert('Nama project harus huruf kecil, angka, atau dash');
                return;
            }

            const htmlContent = await htmlFile.text();
            await deployHTML(projectName, htmlContent);
        }

        async function deployHTML(projectName, htmlContent) {
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('editorSection').style.display = 'none';
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('tabNav').style.display = 'none';

            try {
                addLog('ğŸ“– Memproses...', 'info');

                addLog('ğŸ”¨ Membuat repo GitHub...', 'info');
                await createGitHubRepo(projectName);

                addLog('ğŸ“¤ Upload ke GitHub...', 'info');
                await uploadToGitHub(projectName, htmlContent);

                addLog('ğŸš€ Deploy ke Vercel...', 'info');
                const deployUrl = await deployToVercel(projectName);

                addLog('âœ… Selesai!', 'success');
                
                addToHistory(projectName, deployUrl);
                setTimeout(() => showResult(deployUrl), 500);

            } catch (error) {
                addLog('âŒ Error: ' + error.message, 'error');
                alert('Deploy gagal: ' + error.message);
                document.getElementById('tabNav').style.display = 'flex';
                switchTab(currentTab);
            }
        }

        async function createGitHubRepo(repoName) {
            const res = await fetch('https://api.github.com/user/repos', {
                method: 'POST',
                headers: { 'Authorization': `token ${tokens.github}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: repoName, description: 'Deployed via HTML Deployer Pro', private: false })
            });

            if (!res.ok) {
                const err = await res.json();
                if (err.message.includes('already exists')) {
                    addLog('â„¹ï¸ Repo sudah ada', 'warning');
                    return;
                }
                throw new Error('Gagal buat repo: ' + err.message);
            }
            addLog('âœ“ Repo dibuat', 'success');
        }

        async function uploadToGitHub(repoName, htmlContent) {
            const res = await fetch(`https://api.github.com/repos/${tokens.githubUsername}/${repoName}/contents/index.html`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${tokens.github}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: 'Deploy HTML', content: btoa(unescape(encodeURIComponent(htmlContent))) })
            });

            if (!res.ok) {
                const err = await res.json();
                throw new Error('Gagal upload: ' + err.message);
            }
            addLog('âœ“ File di-upload', 'success');
        }

        async function deployToVercel(repoName) {
            const res = await fetch('https://api.vercel.com/v13/deployments', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${tokens.vercel}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: repoName, gitSource: { type: 'github', repo: `${tokens.githubUsername}/${repoName}`, ref: 'main' } })
            });

            if (!res.ok) {
                const err = await res.json();
                throw new Error('Gagal deploy: ' + (err.error?.message || 'Unknown'));
            }

            addLog('âœ“ Deploy berhasil', 'success');
            return `https://${repoName}.vercel.app`;
        }

        function addLog(msg, type) {
            const log = document.getElementById('progressLog');
            const p = document.createElement('p');
            const colors = { info: '#60a5fa', success: '#4ade80', warning: '#fbbf24', error: '#f87171' };
            p.style.color = colors[type];
            p.style.marginBottom = '0.25rem';
            p.textContent = `> ${msg}`;
            log.appendChild(p
